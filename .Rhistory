scale_fill_brewer(palette = "Set2") +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2))
x <- df %>%
arrange(percent_change_2019_29) %>%
pull(occ_title)
suppress_labels <- function(df, th){
x <- df %>%
arrange(percent_change_2019_29) %>%
pull(occ_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
bls_pand_summary <- bls_pand_mod_summary %>%
rbind(bls_pand_strong_summary) %>% relocate(scenario, .after = "occupation_title")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_fill_brewer(palette = "Set2") +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2))
suppress_labels <- function(df, th){
x <- df %>%
arrange(percent_change_2019_29) %>%
pull(occupation_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_fill_brewer(palette = "Set2") +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2))
bls_pand_summary %>% select(occupation_title, scenario, percent_change_2019_29) %>% View()
suppress_labels <- function(df, th){
x <- df %>%
arrange(percent_change_2019_29) %>%
pull(occupation_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
bls_pand_summary <- bls_pand_mod_summary %>%
rbind(bls_pand_strong_summary) %>% relocate(scenario, .after = "occupation_title")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_fill_brewer(palette = "Set2") +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2))
bls_pand_summary <- bls_pand_mod_summary %>%
rbind(bls_pand_strong_summary) %>% relocate(scenario, .after = "occupation_title")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank())
bls_pand_summary %>% select(occupation_title, scenario, percent_change_2019_29) %>% View()
suppress_labels <- function(df, th){
x <- df %>%
filter(scenario = "moderate") %>%
arrange(percent_change_2019_29) %>%
pull(occupation_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2))
x <- df %>%
filter(scenario == "moderate") %>%
arrange(percent_change_2019_29) %>%
pull(occupation_title)
suppress_labels <- function(df, th){
x <- df %>%
filter(scenario == "moderate") %>%
arrange(percent_change_2019_29) %>%
pull(occupation_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
bls_pand_summary <- bls_pand_mod_summary %>%
rbind(bls_pand_strong_summary) %>% relocate(scenario, .after = "occupation_title")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2))
bls_pand_summary %>% select(occupation_title, scenario, percent_change_2019_29) %>% View()
scale_fill_brewer('Set2')
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2)) +
scale_fill_brewer(palette = 'Set2')
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.8) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2)) +
scale_fill_brewer(palette = 'Set2')
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 2)) +
scale_fill_brewer(palette = 'Set2')
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", ylab = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/4 of occupational titles")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/4 of occupational titles")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank(), legend.title = "Scenario") +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank(), legend.title = element_text("Scenario")) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", color = "Scenario")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", color = "Scenario hello")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario hello")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario")
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_low_level_pct.jpg'), width = 12, height = 8)
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario")
ggsave(here('data/transition_scenarios/BLS_pandemic_projections/bls_pandemic_scenarios_pct.jpg'), width = 12, height = 8)
bls_high_level <- read_xlsx(here('data/transition_scenarios/BLS_employment_projections/occupation.xlsx'), sheet = 2, skip = 1, n_max= 23) %>%
clean_names %>%
rename(occ_title = x2023_national_employment_matrix_title)
bar_plot <- function(df, xlab = NULL, ylab = NULL, title = NULL, subtitle = NULL){
p <- df %>%
arrange(employment_change_percent_2023_33) %>%
ggplot(aes(x = reorder(occ_title, desc(employment_change_percent_2023_33)), y = employment_change_percent_2023_33, fill = employment_change_percent_2023_33 < 0)) +
geom_bar(stat = 'identity') +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1), legend.position = "none", panel.grid.major = element_blank()) +
labs(x = xlab, y = ylab, title = title, subtitle =subtitle)
return(p)
}
bar_plot(bls_high_level, xlab = "Occupation", ylab = "Projected % change from 2023-2033", title = "BLS Employment Projections 2023-2033")
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_high_level_pct.jpg'), width = 8, height = 10)
bls_summary <- read_xlsx(here('data/transition_scenarios/BLS_employment_projections/occupation.xlsx'), sheet = 3, skip = 1, n_max = 1113) %>%
clean_names %>%
rename(occ_title = x2023_national_employment_matrix_title,
occ_code = x2023_national_employment_matrix_code) %>%
filter(occupation_type == "Summary")
suppress_labels <- function(df, th){
x <- df %>%
arrange(employment_change_percent_2023_33) %>%
pull(occ_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
bar_plot(bls_summary,  xlab = "Occupation - Low-level Summary (n = 281)", ylab = "Projected % change from 2023-2033", title = "BLS Employment Projections 2023-2033 (Medium-specificity occupational categories)", subtitle = "Displaying 1/4 of occupational titles") + scale_x_discrete(labels = suppress_labels(bls_summary, 4))
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_summary_level_pct.jpg'), width = 10, height = 8)
bls_low_level <- read_xlsx(here('data/transition_scenarios/BLS_employment_projections/occupation.xlsx'), sheet = 3, skip = 1, n_max = 1113) %>%
clean_names %>%
rename(occ_title = x2023_national_employment_matrix_title,
occ_code = x2023_national_employment_matrix_code) %>%
filter(occupation_type == "Line item")
bar_plot(bls_low_level,  xlab = "Occupation - Low-level Line Items (n = 832)", ylab = "Projected % change from 2023-2033", title = "BLS Employment Projections 2023-2033 (High-specificity occupational categories)", subtitle = "Displaying 1/10 of occupational titles") +
scale_x_discrete(labels = suppress_labels(bls_low_level, 10))
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_low_level_pct.jpg'), width = 12, height = 8)
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario")
bls_pand_mod_summary <- read_xlsx(here('data/transition_scenarios/BLS_pandemic_projections/matrix_pandemic_moderate_impact.xlsx'), skip = 2) %>% clean_names %>% filter(occupation_type == "Summary" & industry_code == "TE1000") %>% select(-c(occupation_type, occupation_code, industry_code, industry_title, industry_type)) %>% mutate(scenario = "moderate")
bls_pand_strong_summary <-read_xlsx(here('data/transition_scenarios/BLS_pandemic_projections/matrix_pandemic_strong_impact.xlsx'), skip = 2) %>% clean_names %>% filter(occupation_type == "Summary" & industry_code == "TE1000") %>% select(-c(occupation_type, occupation_code, industry_code, industry_title, industry_type)) %>% mutate(scenario = "strong")
# bls_pand_mod_summary %>% select(1:9) %>% identical(select(bls_pand_high_summary, 1:9))
# bls_pand_mod_summary %>% full_join(bls_pand_high_summary, by = names(bls_pand_mod_summary)[1:9])
suppress_labels <- function(df, th){
x <- df %>%
filter(scenario == "moderate") %>%
arrange(percent_change_2019_29) %>%
pull(occupation_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
bls_pand_summary <- bls_pand_mod_summary %>%
rbind(bls_pand_strong_summary) %>% relocate(scenario, .after = "occupation_title")
ggplot() +
geom_col(data = filter(bls_pand_summary, scenario == "moderate"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.7) +
geom_col(data = filter(bls_pand_summary, scenario == "strong"), aes(x = reorder(occupation_title, desc(percent_change_2019_29)), y = percent_change_2019_29, fill = scenario), alpha = 0.5) +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1),  panel.grid.major = element_blank()) +
scale_x_discrete(labels = suppress_labels(bls_pand_summary, 3)) +
scale_fill_brewer(palette = 'Set2') +
labs(x = "Occupation - Low-level Summary (n = 258)", y = "Projected % change from 2019-2029", title = "BLS Pandemic Employment Projections 2019-2029 (Medium-specificity occupational categories)", subtitle = "Displaying 1/3 of occupational titles", fill = "Scenario")
ggsave(here('data/transition_scenarios/BLS_pandemic_projections/bls_pandemic_scenarios_pct.jpg'), width = 12, height = 8)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(readxl)
library(tidyverse)
library(janitor)
library(ggbump)
library(assertthat)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(readxl)
library(tidyverse)
library(janitor)
library(ggbump)
library(assertthat)
bls_high_level <- read_xlsx(here('data/transition_scenarios/BLS_employment_projections/occupation.xlsx'), sheet = 2, skip = 1, n_max= 23) %>%
clean_names %>%
rename(occ_title = x2023_national_employment_matrix_title)
bar_plot <- function(df, xlab = NULL, ylab = NULL, title = NULL, subtitle = NULL){
p <- df %>%
arrange(employment_change_percent_2023_33) %>%
ggplot(aes(x = reorder(occ_title, desc(employment_change_percent_2023_33)), y = employment_change_percent_2023_33, fill = employment_change_percent_2023_33 < 0)) +
geom_bar(stat = 'identity') +
theme_minimal() +
theme(axis.text.x=element_text(angle = 90, hjust = 1), legend.position = "none", panel.grid.major = element_blank()) +
labs(x = xlab, y = ylab, title = title, subtitle =subtitle)
return(p)
}
bar_plot(bls_high_level, xlab = "Occupation", ylab = "Projected % change from 2023-2033", title = "BLS Employment Projections 2023-2033")
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_high_level_pct.jpg'), width = 8, height = 10)
bls_summary <- read_xlsx(here('data/transition_scenarios/BLS_employment_projections/occupation.xlsx'), sheet = 3, skip = 1, n_max = 1113) %>%
clean_names %>%
rename(occ_title = x2023_national_employment_matrix_title,
occ_code = x2023_national_employment_matrix_code) %>%
filter(occupation_type == "Summary")
suppress_labels <- function(df, th){
x <- df %>%
arrange(employment_change_percent_2023_33) %>%
pull(occ_title)
for(i in 1:(th-1)){
x[seq(i, length(x), th)] <- ""
}
rev(x)
}
bar_plot(bls_summary,  xlab = "Occupation - Low-level Summary (n = 281)", ylab = "Projected % change from 2023-2033", title = "BLS Employment Projections 2023-2033 (Medium-specificity occupational categories)", subtitle = "Displaying 1/4 of occupational titles") + scale_x_discrete(labels = suppress_labels(bls_summary, 4))
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_summary_level_pct.jpg'), width = 10, height = 8)
bls_low_level <- read_xlsx(here('data/transition_scenarios/BLS_employment_projections/occupation.xlsx'), sheet = 3, skip = 1, n_max = 1113) %>%
clean_names %>%
rename(occ_title = x2023_national_employment_matrix_title,
occ_code = x2023_national_employment_matrix_code) %>%
filter(occupation_type == "Line item")
bar_plot(bls_low_level,  xlab = "Occupation - Low-level Line Items (n = 832)", ylab = "Projected % change from 2023-2033", title = "BLS Employment Projections 2023-2033 (High-specificity occupational categories)", subtitle = "Displaying 1/10 of occupational titles") +
scale_x_discrete(labels = suppress_labels(bls_low_level, 10))
ggsave(here('data/transition_scenarios/BLS_employment_projections/bls_low_level_pct.jpg'), width = 12, height = 8)
proj_dates <- list.files(here('data/transition_scenarios/BLS_employment_projections/past_projections')) %>% .[!grepl("zip", .)]
# Keeps track of required occupation codes for 23 occupations forecast at this higher level
occ_codes <- list()
pred_data <- bls_high_level %>%
rename(occ_code = 2) %>%
mutate(occ_title = tolower(occ_title),
occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations", occ_title)) %>%
select(occ_code, occ_title, employment_2023, employment_2033) %>%
pivot_longer(!c(occ_code, occ_title)) %>%
separate(name, into = c("type", "year"), sep = "_") %>%
mutate(type = ifelse(year == 2023, "actual", "predicted"),
year = as.numeric(year),
forecast = proj)
pred_data <- bls_high_level %>%
rename(occ_code = 2) %>%
mutate(occ_title = tolower(occ_title),
occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations", occ_title)) %>%
select(occ_code, occ_title, employment_2023, employment_2033) %>%
pivot_longer(!c(occ_code, occ_title)) %>%
separate(name, into = c("type", "year"), sep = "_") %>%
mutate(type = ifelse(year == 2023, "actual", "predicted"),
year = as.numeric(year),
forecast = '2023-33')
for(proj in rev(proj_dates)){
print(proj)
tbl <- read_xlsx(here(paste0('data/transition_scenarios/BLS_employment_projections/past_projections/',proj, '/occupation.xlsx')), sheet = 2, skip = 1) %>%
filter(!grepl("Footnotes:|Source:|Note:|Data are from|Wage included represents", .[[1]])) %>% clean_names %>%
rename_with(~gsub(., "occ_title", .), contains('title')) %>%
rename_with(~gsub(., "occ_code", .), contains('code')) %>%
rename_with(~gsub("_1", "", .), ends_with("_1")) %>%
mutate(occ_title = tolower(occ_title)) %>%
mutate(occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations", occ_title)) %>%
relocate(occ_title) %>%
select(occ_code, occ_title, contains("emp"))
if(proj == "2008-18"){
tbl <- read_xlsx(here(paste0('data/transition_scenarios/BLS_employment_projections/past_projections/2008-18/occupation.xlsx')), sheet = 3, skip = 1) %>%
filter(!grepl("Footnotes:|Source:|Note:|Data are from|Wage included represents", .[[1]])) %>% clean_names %>%
rename_with(~gsub(., "occ_title", .), contains('title')) %>%
rename_with(~gsub(., "occ_code", .), contains('code')) %>%
rename_with(~gsub("_1", "", .), ends_with("_1")) %>%
mutate(occ_title = tolower(occ_title)) %>%
# Replace a few occupation titles that have slightly different names in 2008 (computer/math, comm/social services) and 2019 ("educational instruction and library occupations")
mutate(occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations",
ifelse(occ_title == "computer and mathematical science occupations", "computer and mathematical occupations",
ifelse(occ_title == "community and social services occupations", "community and social service occupations", occ_title)))) %>%
filter(occ_code %in% occ_codes) %>% relocate(occ_title) %>%
select(occ_code, occ_title, contains("emp")) %>%
select(-c("employment_percent_2008", "employment_percent_2018"))}
assign(paste0("proj_", gsub("-", "_", proj)), tbl)
occ_codes <- tbl %>% pull(occ_code) %>% c(., occ_codes) %>% unique
# Should print 23
assert_that(length(occ_codes) == 23)
pred_data <- tbl %>%
select(occ_code, occ_title, eval(paste0('employment_', substr(proj, 1,4))), eval(paste0('employment_20', substr(proj,6,7)))) %>%
pivot_longer(!c(occ_code, occ_title)) %>%
separate(name, into = c("type", "year"), sep = "_") %>%
mutate(type = ifelse(year == substr(proj, 1,4), "actual", "predicted"),
year = as.numeric(year),
forecast = proj) %>%
rbind(pred_data,.)
}
for(proj in rev(proj_dates)){
print(proj)
tbl <- read_xlsx(here(paste0('data/transition_scenarios/BLS_employment_projections/past_projections/',proj, '/occupation.xlsx')), sheet = 2, skip = 1) %>%
filter(!grepl("Footnotes:|Source:|Note:|Data are from|Wage included represents", .[[1]])) %>% clean_names %>%
rename_with(~gsub(., "occ_title", .), contains('title')) %>%
rename_with(~gsub(., "occ_code", .), contains('code')) %>%
rename_with(~gsub("_1", "", .), ends_with("_1")) %>%
mutate(occ_title = tolower(occ_title)) %>%
mutate(occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations", occ_title)) %>%
relocate(occ_title) %>%
select(occ_code, occ_title, contains("emp"))
if(proj == "2008-18"){
tbl <- read_xlsx(here(paste0('data/transition_scenarios/BLS_employment_projections/past_projections/2008-18/occupation.xlsx')), sheet = 3, skip = 1) %>%
filter(!grepl("Footnotes:|Source:|Note:|Data are from|Wage included represents", .[[1]])) %>% clean_names %>%
rename_with(~gsub(., "occ_title", .), contains('title')) %>%
rename_with(~gsub(., "occ_code", .), contains('code')) %>%
rename_with(~gsub("_1", "", .), ends_with("_1")) %>%
mutate(occ_title = tolower(occ_title)) %>%
# Replace a few occupation titles that have slightly different names in 2008 (computer/math, comm/social services) and 2019 ("educational instruction and library occupations")
mutate(occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations",
ifelse(occ_title == "computer and mathematical science occupations", "computer and mathematical occupations",
ifelse(occ_title == "community and social services occupations", "community and social service occupations", occ_title)))) %>%
filter(occ_code %in% occ_codes) %>% relocate(occ_title) %>%
select(occ_code, occ_title, contains("emp")) %>%
select(-c("employment_percent_2008", "employment_percent_2018"))}
assign(paste0("proj_", gsub("-", "_", proj)), tbl)
occ_codes <- tbl %>% pull(occ_code) %>% c(., occ_codes) %>% unique
# Should print 23
assert_that(length(occ_codes) == 23)
pred_data <- tbl %>%
select(occ_code, occ_title, eval(paste0('employment_', substr(proj, 1,4))), eval(paste0('employment_20', substr(proj,6,7)))) %>%
pivot_longer(!c(occ_code, occ_title)) %>%
separate(name, into = c("type", "year"), sep = "_") %>%
mutate(type = ifelse(year == substr(proj, 1,4), "actual", "predicted"),
year = as.numeric(year),
forecast = proj) %>%
rbind(pred_data,.)
}
proj_dates <- list.files(here('data/transition_scenarios/BLS_employment_projections/past_projections')) %>% .[!grepl("zip|jpg", .)]
# Keeps track of required occupation codes for 23 occupations forecast at this higher level
occ_codes <- list()
pred_data <- bls_high_level %>%
rename(occ_code = 2) %>%
mutate(occ_title = tolower(occ_title),
occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations", occ_title)) %>%
select(occ_code, occ_title, employment_2023, employment_2033) %>%
pivot_longer(!c(occ_code, occ_title)) %>%
separate(name, into = c("type", "year"), sep = "_") %>%
mutate(type = ifelse(year == 2023, "actual", "predicted"),
year = as.numeric(year),
forecast = '2023-33')
for(proj in rev(proj_dates)){
print(proj)
tbl <- read_xlsx(here(paste0('data/transition_scenarios/BLS_employment_projections/past_projections/',proj, '/occupation.xlsx')), sheet = 2, skip = 1) %>%
filter(!grepl("Footnotes:|Source:|Note:|Data are from|Wage included represents", .[[1]])) %>% clean_names %>%
rename_with(~gsub(., "occ_title", .), contains('title')) %>%
rename_with(~gsub(., "occ_code", .), contains('code')) %>%
rename_with(~gsub("_1", "", .), ends_with("_1")) %>%
mutate(occ_title = tolower(occ_title)) %>%
mutate(occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations", occ_title)) %>%
relocate(occ_title) %>%
select(occ_code, occ_title, contains("emp"))
if(proj == "2008-18"){
tbl <- read_xlsx(here(paste0('data/transition_scenarios/BLS_employment_projections/past_projections/2008-18/occupation.xlsx')), sheet = 3, skip = 1) %>%
filter(!grepl("Footnotes:|Source:|Note:|Data are from|Wage included represents", .[[1]])) %>% clean_names %>%
rename_with(~gsub(., "occ_title", .), contains('title')) %>%
rename_with(~gsub(., "occ_code", .), contains('code')) %>%
rename_with(~gsub("_1", "", .), ends_with("_1")) %>%
mutate(occ_title = tolower(occ_title)) %>%
# Replace a few occupation titles that have slightly different names in 2008 (computer/math, comm/social services) and 2019 ("educational instruction and library occupations")
mutate(occ_title = ifelse(occ_title == "educational instruction and library occupations", "education, training, and library occupations",
ifelse(occ_title == "computer and mathematical science occupations", "computer and mathematical occupations",
ifelse(occ_title == "community and social services occupations", "community and social service occupations", occ_title)))) %>%
filter(occ_code %in% occ_codes) %>% relocate(occ_title) %>%
select(occ_code, occ_title, contains("emp")) %>%
select(-c("employment_percent_2008", "employment_percent_2018"))}
assign(paste0("proj_", gsub("-", "_", proj)), tbl)
occ_codes <- tbl %>% pull(occ_code) %>% c(., occ_codes) %>% unique
# Should print 23
assert_that(length(occ_codes) == 23)
pred_data <- tbl %>%
select(occ_code, occ_title, eval(paste0('employment_', substr(proj, 1,4))), eval(paste0('employment_20', substr(proj,6,7)))) %>%
pivot_longer(!c(occ_code, occ_title)) %>%
separate(name, into = c("type", "year"), sep = "_") %>%
mutate(type = ifelse(year == substr(proj, 1,4), "actual", "predicted"),
year = as.numeric(year),
forecast = proj) %>%
rbind(pred_data,.)
}
ggplot() +
geom_line(data = filter(pred_data, type == "predicted", occ_title != "total, all occupations"), aes(x = year, y = log(value), color = occ_title), linetype = "dashed") +
geom_point(data = filter(pred_data, type == "actual", occ_title != "total, all occupations"), aes(x = year, y = log(value), color = occ_title)) +
geom_line(data = filter(pred_data, type == "actual", occ_title != "total, all occupations"), aes(x = year, y = log(value), color = occ_title)) +
facet_wrap(~occ_title, scales = "free", ncol = 3) +
theme_minimal() +
theme(legend.position = "none") +
labs(x = "Year", y = "Employment (log)", title = "BLS: Predicted and actual occupation-specific employment")
ggplot() +
geom_rect(data = pred_data, xmin = 2018, xmax = 2023, ymin = -Inf, ymax = Inf, fill = "lightblue", alpha = 0.02) +
geom_line(data = filter(pred_data, type == "predicted", occ_title != "total, all occupations"), aes(x = year, y = log(value), color = occ_title), linetype = "dashed") +
geom_point(data = filter(pred_data, type == "actual", occ_title != "total, all occupations"), aes(x = year, y = log(value), color = occ_title)) +
geom_line(data = filter(pred_data, type == "actual", occ_title != "total, all occupations"), aes(x = year, y = log(value), color = occ_title)) +
geom_line(data = filter(pred_data, occ_title != "total, all occupations"), aes(x = year, y = log(value), group = forecast, color = occ_title), linetype = "dotted", alpha = 0.6) +
facet_wrap(~occ_title, scales = "free", ncol = 3) +
theme_minimal() +
theme(legend.position = "none") +
labs(x = "Year", y = "Employment (log)", title = "BLS: Predicted and actual occupation-specific employment", caption = "The dots and solid lines represent the actual realised values of occupational employment levels. \nThe dashed line indicates the 10-year ahead forecast of occupation-specific employment. \nThe dotted lines connect the base year value to the forecasted value. \nAll values are reported as part of the BLS Employment Projections. \nThe light blue shaded area indicates where forecasts have corresponding real-world values for comparison (2018-23).") +
theme(plot.caption = element_text(hjust = 0, size = 12))
ggsave(here('data/transition_scenarios/BLS_employment_projections/past_projections/bls_real_forecast_values.jpg'), width = 10, height = 12)
