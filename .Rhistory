filter(is.na(women_pct))
# All categories now either have a reported gender share OR another ipums label that is arguably similar
# This will need to be documented
gend_shares %>%
group_by(ipums_label) %>%
# Testing for line items that do not have a gender share NOR a similar category
filter(all(is.na(women_pct)) & all(is.na(ipums_similar)))
## Checking to see if all "similar" items have  a reported gender share
similars <- gend_shares %>%
pull(ipums_similar) %>%
unique
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar) %>%
select(ipums_label, women_pct)
# Replace women_pct where missing and a similar category has been identified
gend_shares$women_pct <- ifelse(is.na(gend_shares$women_pct) & gend_shares$ipums_similar %in% similars_comp$ipums_label, similars_comp$women_pct, gend_shares$women_pct)
gend_shares %>%
filter(is.na(women_pct))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(mean(women_pct, na.rm = TRUE))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE)) %>% filter(is.nan(women_pct))
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
#ipums_label = trimws(ipums_label))
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
setdiff(gend_shares$ipums_label, ipums$label)
setdiff(ipums$label, gend_shares$ipums_label)
gend_shares %>%
filter(is.na(women_pct))
# All categories now either have a reported gender share OR another ipums label that is arguably similar
# This will need to be documented
gend_shares %>%
group_by(ipums_label) %>%
# Testing for line items that do not have a gender share NOR a similar category
filter(all(is.na(women_pct)) & all(is.na(ipums_similar)))
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar) %>%
select(ipums_label, women_pct)
gend_shares %>% filter(ipums_label == "human resources managers")
gend_shares %>% filter(ipums_label == "human resources managers" | ipums_label == "human resources managers")
gend_shares %>% filter(ipums_label == "human resources managers" | ipums_similar == "human resources managers")
# Replace women_pct where missing and a similar category has been identified
gend_shares$women_pct <- ifelse(is.na(gend_shares$women_pct) & gend_shares$ipums_similar %in% similars_comp$ipums_label, similars_comp$women_pct, gend_shares$women_pct)
gend_shares %>% filter(ipums_label == "human resources managers" | ipums_similar == "human resources managers")
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
setdiff(gend_shares$ipums_label, ipums$label)
setdiff(ipums$label, gend_shares$ipums_label)
gend_shares %>%
filter(is.na(women_pct))
# Replace women_pct where missing and a similar category has been identified
gend_shares$women_pct <- ifelse(is.na(gend_shares$women_pct) & gend_shares$ipums_similar %in% similars_comp$ipums_label, similars_comp$women_pct, gend_shares$women_pct)
gend_shares %>%
filter(is.na(women_pct))
gend_shares %>% filter(ipums_label == "human resources managers" | ipums_similar == "human resources managers")
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
setdiff(gend_shares$ipums_label, ipums$label)
setdiff(ipums$label, gend_shares$ipums_label)
gend_shares %>%
filter(is.na(women_pct))
# All categories now either have a reported gender share OR another ipums label that is arguably similar
# This will need to be documented
gend_shares %>%
group_by(ipums_label) %>%
# Testing for line items that do not have a gender share NOR a similar category
filter(all(is.na(women_pct)) & all(is.na(ipums_similar)))
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar) %>%
select(ipums_label, women_pct)
similars_comp
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar) %>%
select(ipums_label, women_pct)
similars <- similars_comp %>% pull(women_pct)
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar) %>%
select(ipums_label, women_pct)
similars <- similars_comp %>% pull(women_pct)
names(similars) <- similars_comp %>% pull(ipums_label)
similars
similars["24.2"]
similars[24.2]
similars["miscellaneous social scientists, including survey researchers and sociologists"]
similars[["miscellaneous social scientists, including survey researchers and sociologists"]]
similars$`miscellaneous social scientists, including survey researchers and sociologists`
similars$'miscellaneous social scientists, including survey researchers and sociologists''
\''
similars$'miscellaneous social scientists, including survey researchers and sociologists'
similars <- similars_comp %>% pull(women_pct)
names(similars) <- similars_comp %>% pull(ipums_label)
similars
similars[which(names(similars) == "stock clerks and order fillers")]
similars[which(names(similars) == "stock clerks and order fillers")] %>% unlist
similars[which(names(similars) == "stock clerks and order fillers")][1]
similars[which(names(similars) == "stock clerks and order fillers")][[1]]
gend_shares %>%
mutate(women_pct = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct))
gend_shares %>%
mutate(women_pct2 = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct))
gend_shares %>%
mutate(women_pct2 = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct)) %>%
filter(women_pct != women_pct2)
temp <- gend_shares %>%
mutate(women_pct2 = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct)) #%>%
temp
temp %>% filter(women_pct != women_pct2)
temp %>% filter(is.na(women_pct)
)
temp %>% filter(is.na(women_pct2))
similars[which(names(similars) == ipums_similar)][[1]]
similars[which(names(similars) == "stock clerks and order fillers")][[1]]
similars[which(names(similars) == "stock clerks and order fillers")][[1]] %>% unlist
gend_shares %>%
left_join(., by.x = "ipums_similar", by.y = "ipums_label")
?left_join
gend_shares %>%
left_join(., by = c("ipums_similar" = "ipums_label"))
gend_shares %>%
left_join(., similars, by = c("ipums_similar" = "ipums_label"))
gend_shares %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
gend_shares %>% unique
gend_shares %>% slice(31)
similars_comp %>% slice(9)
similars_comp
similars_comp %>% pull(ipums_label) %>% n_distinct
similars_comp %>% group_by(ipums_label) %>% filter(nrow(.) > 1)
similars_comp %>% arrange(ipums_label)
similars_comp %>% group_by(ipums_label) %>% arrange(n())
similars_comp %>% group_by(ipums_label) %>% mutate(n = n()) %>% arrange(n)
similars_comp %>% group_by(ipums_label) %>% mutate(n = n()) %>% arrange(-n)
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
gend_shares %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
gend_shares %>% slice(31)
similars_comp %>% slice(7)
similars_comp %>% group_by(ipums_label) %>% mutate(n = n()) %>% arrange(-n)
gend_shares %>% group_by(ipums_label) %>% mutate(n = n())
gend_shares %>% group_by(ipums_label) %>% mutate(n = n()) %>% filter(n > 1)
gend_shares %>% group_by(ipums_label) %>% mutate(n = n()) %>% filter(n > 1) %>% filter(!is.na(ipums_similar))
gend_shares %>% group_by(ipums_label) %>% mutate(n = n()) %>% filter(n > 1) %>% filter(!is.na(ipums_similar)) %>% slice(1)
gend_shares %>% group_by(ipums_label) %>% mutate(n = n()) %>% filter(n > 1) %>% filter(!is.na(ipums_similar)) %>% slice(1)  %>% pull(ipums_label)
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
setdiff(gend_shares$ipums_label, ipums$label)
setdiff(ipums$label, gend_shares$ipums_label)
gend_shares %>%
filter(is.na(women_pct))
# All categories now either have a reported gender share OR another ipums label that is arguably similar
# This will need to be documented
gend_shares %>%
group_by(ipums_label) %>%
# Testing for line items that do not have a gender share NOR a similar category
filter(all(is.na(women_pct)) & all(is.na(ipums_similar)))
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
gend_shares %>% group_by(ipums_label) %>% mutate(n = n()) %>% filter(n > 1) %>% filter(!is.na(ipums_similar)) %>% slice(1)  %>% pull(ipums_label)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar))
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(test)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
library(tidyverse)
library(here)
library(readxl)
getwd()
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label))
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "text"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct", "notes")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label)) %>%
select(occupation, ipums_label, ipums_similar, women_pct)
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
# All categories now either have a reported gender share OR another ipums label that is arguably similar
# This will need to be documented
gend_shares %>%
group_by(ipums_label) %>%
# Testing for line items that do not have a gender share NOR a similar category
filter(all(is.na(women_pct)) & all(is.na(ipums_similar)))
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE)) %>% filter(is.nan(women_pct))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE)) %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
gend_shares
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE)) %>%
ungroup %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
#left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
mutate(women_pct2 = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct)) #%>%
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
filter(women_pct != NaN)
filter(!is.nan(women_pct)
gend_shares %>%
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
filter(!is.nan(women_pct))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
filter(is.nan(women_pct) & is.na(ipums_similar))
ungroup %>% filter(grepl("miscellaneous social scientists", ipums_label)
)
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>% filter(grepl("miscellaneous social scientists", ipums_label))
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "text"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct", "notes")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label)) %>%
select(occupation, ipums_label, ipums_similar, women_pct)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(test)
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>% filter(grepl("miscellaneous social scientists", ipums_label))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
filter(is.nan(women_pct) & is.na(ipums_similar))
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "text"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct", "notes")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label)) %>%
select(occupation, ipums_label, ipums_similar, women_pct)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(test)
gend_shares %>% group_by(ipums_label) %>% summarise(test = n_distinct(ipums_similar)) %>% arrange(-test)
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
filter(is.nan(women_pct) & is.na(ipums_similar))
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
#left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
mutate(women_pct2 = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct)) #%>%
gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
temp %>% slice(31)
similars_comp %>% slice(7)
temp %>% slice(31) %>% pull(occupation)
temp <- gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
temp %>% slice(17)
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "text"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct", "notes")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label)) %>%
select(occupation, ipums_label, ipums_similar, women_pct)
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
temp <- gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
temp %>% slice(17)
gend_shares <- read_xlsx(here("data/occ_gender_shares.xlsx"), skip = 2, na = "-",
col_types = c("text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "text"),
col_names = c("occupation", "ipums_label", "ipums_similar", "total_employed", "women_pct", "white_pct", "black_afam_pct", "asian_pct", "hispanic_latinx_pct", "notes")) %>%
mutate(occupation = tolower(occupation)) %>%
filter(!is.na(ipums_label)) %>%
select(occupation, ipums_label, ipums_similar, women_pct)
#ipums_label = trimws(ipums_label))
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
#setdiff(gend_shares$ipums_label, ipums$label)
#setdiff(ipums$label, gend_shares$ipums_label)
#gend_shares %>%
#  filter(is.na(women_pct))
# All categories now either have a reported gender share OR another ipums label that is arguably similar
# This will need to be documented
#gend_shares %>%
#  group_by(ipums_label) %>%
# Testing for line items that do not have a gender share NOR a similar category
#filter(all(is.na(women_pct)) & all(is.na(ipums_similar)))
temp <- gend_shares %>%
# group by ipums_similar in the cases where they are a sum value of
group_by(ipums_label) %>%
summarise(women_pct = mean(women_pct, na.rm = TRUE),
ipums_similar = unique(ipums_similar)) %>%
ungroup
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- gend_shares %>%
filter(ipums_label %in% gend_shares$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
# similars <- similars_comp %>% pull(women_pct)
# names(similars) <- similars_comp %>% pull(ipums_label)
# Replace women_pct where missing and a similar category has been identified
#gend_shares$women_pct <- ifelse(is.na(gend_shares$women_pct) & gend_shares$ipums_similar %in% similars_comp$ipums_label, similars_comp$women_pct, gend_shares$women_pct)
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
temp %>% slice(17)
similar_comp %>% filter(ipums_label == "bus drivers")
similar_comps %>% filter(ipums_label == "bus drivers")
similars_comp %>% filter(ipums_label == "bus drivers")
temp %>% filter(ipums_label == "bus drivers")
## Checking to see if all "similar" items have  a reported gender share
similars_comp <- temp %>%
filter(ipums_label %in% temp$ipums_similar & !is.na(women_pct)) %>%
select(ipums_label, women_pct)
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
# Replace women_pct where missing and a similar category has been identified
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct2 = ifelse(is.na(women_pct), similars[which(names(similars) == ipums_similar)][[1]], women_pct)) #%>%
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label"))
# Replace women_pct where missing and a similar category has been identified
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct2 = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) #%>%
# Replace women_pct where missing and a similar category has been identified
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct2 = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) %>%
filter(is.na(women_pct2))
# Replace women_pct where missing and a similar category has been identified
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) %>%
filter(is.na(women_pct))
# Replace women_pct where missing and a similar category has been identified
temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) %>%
select(ipums_label, women_pct)
ipums <- read.csv(here('dRC_Replication/data/ipums_variables.csv')) %>%
tibble %>%
mutate(label = trimws(label))
# Replace women_pct where missing and a similar category has been identified
final <- temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) %>%
select(ipums_label, women_pct)
# Replace women_pct where missing and a similar category has been identified
final_shares <- temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) %>%
select(ipums_label, women_pct)
setdiff(final_shares$ipums_label, ipums$label)
setdiff(ipums$label, final_shares$ipums_label)
setdiff(final_shares$ipums_label, ipums$label)
setdiff(ipums$label, final_shares$ipums_label)
ipums %>% left_join(., final_shares, by = c("label" = "ipums_label"))
ipums %>% left_join(., final_shares, by = c("label" = "ipums_label")) %>% select(-12)
ipums %>% left_join(., final_shares, by = c("label" = "ipums_label")) %>% select(-12) %>% identical(ipums)
#ipums %>% left_join(., final_shares, by = c("label" = "ipums_label")) %>% select(-12) %>% identical(ipums)
ipums %>% left_join(., final_shares, by = c("label" = "ipums_label")) %>% write.csv(here("data/ipums_variables_w_gender.csv"))
# Replace women_pct where missing and a similar category has been identified
final_shares <- temp %>%
left_join(., similars_comp, by = c("ipums_similar" = "ipums_label")) %>%
mutate(women_pct = ifelse(is.na(women_pct.x),women_pct.y, women_pct.x)) %>%
select(ipums_label, women_pct) %>%
mutate(women_pct = women_pct/100)
setdiff(final_shares$ipums_label, ipums$label)
setdiff(ipums$label, final_shares$ipums_label)
final_shares
#ipums %>% left_join(., final_shares, by = c("label" = "ipums_label")) %>% select(-12) %>% identical(ipums)
ipums %>% left_join(., final_shares, by = c("label" = "ipums_label")) %>% write.csv(here("data/ipums_variables_w_gender.csv"))
